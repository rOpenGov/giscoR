---
output: github_document
editor_options: 
  markdown: 
    wrap: 80
---

<!-- README.md is generated from README.Rmd. Please edit that file -->

```{r, include = FALSE}


knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  warning = FALSE,
  message = FALSE,
  tidy = "styler",
  dpi = 300,
  fig.path = "man/figures/README-",
  out.width = "100%"
)


if (isFALSE(requireNamespace("dplyr", quietly = TRUE))) {
  install.packages("dplyr")
}
```

# giscoR <img src="man/figures/logo.png" align="right" width="120"/>

<!-- badges: start -->

[![CRAN
status](https://www.r-pkg.org/badges/version/giscoR)](https://CRAN.R-project.org/package=giscoR)
[![CRAN
results](https://cranchecks.info/badges/worst/giscoR)](https://cran.r-project.org/web/checks/check_results_giscoR.html)
[![Downloads](https://cranlogs.r-pkg.org/badges/giscoR)](https://CRAN.R-project.org/package=giscoR)
[![r-universe](https://dieghernan.r-universe.dev/badges/giscoR)](https://dieghernan.r-universe.dev/)
[![R build
status](https://github.com/dieghernan/giscoR/workflows/R-CMD-check/badge.svg)](https://github.com/dieghernan/giscoR/actions)
[![codecov](https://codecov.io/gh/dieghernan/giscoR/branch/master/graph/badge.svg)](https://codecov.io/gh/dieghernan/giscoR)
[![DOI](https://img.shields.io/badge/DOI-10.5281/zenodo.4317946-blue)](https://doi.org/10.5281/zenodo.4317946)
[![CodeFactor](https://www.codefactor.io/repository/github/dieghernan/giscor/badge)](https://www.codefactor.io/repository/github/dieghernan/giscor)
[![Project Status:
Active](https://www.repostatus.org/badges/latest/active.svg)](https://www.repostatus.org/#active)

<!-- badges: end -->

[giscoR](https://dieghernan.github.io/giscoR/) is an API package that helps to
retrieve data from [Eurostat - GISCO (the Geographic Information System of the
COmmission)](https://ec.europa.eu/eurostat/web/gisco). It also provides some
lightweight data sets ready to use without downloading.

GISCO [(FAQ)](https://ec.europa.eu/eurostat/web/gisco/faq) is a geospatial open
data repository including several data sets as countries, coastal lines, labels
or [NUTS levels](https://ec.europa.eu/eurostat/web/regions-and-cities/overview).
The data sets are usually provided at several resolution levels
(60M/20M/10M/03M/01M) and in 3 different projections (4326/3035/3857).

Note that the package does not provide metadata on the downloaded files, the
information is available on the [API
webpage](https://gisco-services.ec.europa.eu/distribution/v2/).

Full site with examples and vignettes on <https://dieghernan.github.io/giscoR/>

## Installation

Install `giscoR` from [**CRAN**](https://CRAN.R-project.org/package=giscoR):

```{r, eval=FALSE}
install.packages("giscoR")
```

You can install the developing version of `giscoR` with:

```{r, eval=FALSE}
library(remotes)
install_github("dieghernan/giscoR")
```

Alternatively, you can install `giscoR` using the
[r-universe](https://dieghernan.r-universe.dev/ui#builds):

```{r, eval=FALSE}
# Enable this universe
options(repos = c(
  dieghernan = "https://dieghernan.r-universe.dev",
  CRAN = "https://cloud.r-project.org"
))


install.packages("giscoR")
```

## Usage

This script highlights some features of `giscoR`:

```{r example}

library(giscoR)
library(sf)
library(dplyr)

# Different resolutions
DNK_res60 <- gisco_get_countries(resolution = "60", country = "DNK") %>%
  mutate(res = "60M")
DNK_res20 <-
  gisco_get_countries(resolution = "20", country = "DNK") %>%
  mutate(res = "20M")
DNK_res10 <-
  gisco_get_countries(resolution = "10", country = "DNK") %>%
  mutate(res = "10M")
DNK_res03 <-
  gisco_get_countries(resolution = "03", country = "DNK") %>%
  mutate(res = "03M")


DNK_all <- bind_rows(DNK_res60, DNK_res20, DNK_res10, DNK_res03)

# Plot ggplot2

library(ggplot2)

ggplot(DNK_all) +
  geom_sf(fill = "tomato") +
  facet_wrap(vars(res)) +
  theme_minimal()


# Labels and Lines available

labs <- gisco_get_countries(
  spatialtype = "LB",
  region = "Africa",
  epsg = "3857"
)

coast <- gisco_get_countries(
  spatialtype = "COASTL",
  epsg = "3857"
)

# For zooming
afr_bbox <- st_bbox(labs)

ggplot(coast) +
  geom_sf(col = "deepskyblue4", size = 3) +
  geom_sf(data = labs, fill = "springgreen4", col = "darkgoldenrod1", size = 5, shape = 21) +
  coord_sf(
    xlim = afr_bbox[c("xmin", "xmax")],
    ylim = afr_bbox[c("ymin", "ymax")]
  )
```

### Labels

An example of a labeled map using `ggplot2`:

```{r labels, fig.height=7, fig.width=6}

ITA <- gisco_get_nuts(country = "Italy", nuts_level = 1)

ggplot(ITA) +
  geom_sf() +
  geom_sf_text(aes(label = NAME_LATN)) +
  theme(axis.title = element_blank())
```

### Thematic maps

An example of a thematic map plotted with the `ggplot2` package. The information
is extracted via the `eurostat` package. We would follow the fantastic approach
presented by [Milos Popovic](https://twitter.com/milos_agathon) on [this
post](https://milospopovic.net/how-to-make-choropleth-map-in-r/):

```{r eurostat_install, include = FALSE}

if (isFALSE(requireNamespace("eurostat", quietly = TRUE))) {
  install.packages("eurostat")
}
```

```{r thematic, fig.asp=1.1}

# Get shapes
nuts3 <- gisco_get_nuts(
  year = "2016",
  epsg = "3035",
  resolution = "3",
  nuts_level = "3"
)

# Group by NUTS by country and convert to lines
country_lines <- nuts3 %>%
  group_by(
    CNTR_CODE
  ) %>%
  summarise(n = n()) %>%
  st_cast("MULTILINESTRING")


# Use eurostat
library(eurostat)

popdens <- get_eurostat("demo_r_d3dens")
popdens <- popdens[popdens$time == "2018-01-01", ]


# Merge data
nuts3.sf <- merge(nuts3,
  popdens,
  by.x = "NUTS_ID",
  by.y = "geo",
  all.x = TRUE
)

# Breaks and labels

br <- c(0, 25, 50, 100, 200, 500, 1000, 2500, 5000, 10000, 30000)

nuts3.sf$values_cut <- cut(nuts3.sf$values,
  breaks = br,
  dig.lab = 5
)

labs_plot <- prettyNum(br[-1], big.mark = ",")


# Palette
pal <- hcl.colors(length(br) - 1, "Lajolla")


# Plot

ggplot(nuts3.sf) +
  geom_sf(aes(fill = values_cut), size = 0, color = NA, alpha = 0.9) +
  geom_sf(data = country_lines, col = "black", size = 0.1) +
  # Center in Europe: EPSG 3035
  coord_sf(
    xlim = c(2377294, 7453440),
    ylim = c(1313597, 5628510)
  ) +
  labs(
    title = "Population density in 2018",
    subtitle = "NUTS-3 level",
    caption = paste0(
      "Source: Eurostat, ", gisco_attributions(),
      "\nBased on Milos Popovic: https://milospopovic.net/how-to-make-choropleth-map-in-r/"
    )
  ) +
  scale_fill_manual(
    name = "people per sq. kilometer",
    values = pal,
    labels = labs_plot,
    drop = FALSE,
    guide = guide_legend(
      direction = "horizontal",
      keyheight = 0.5,
      keywidth = 2.5,
      title.position = "top",
      title.hjust = 0.5,
      label.hjust = .5,
      nrow = 1,
      byrow = TRUE,
      reverse = FALSE,
      label.position = "bottom"
    )
  ) +
  theme_void() +
  # Theme
  theme(
    plot.title = element_text(
      size = 20, color = pal[length(pal) - 1],
      hjust = 0.5, vjust = -10
    ),
    plot.subtitle = element_text(
      size = 14,
      color = pal[length(pal) - 1],
      hjust = 0.5, vjust = -15, face = "bold"
    ),
    plot.caption = element_text(
      size = 9, color = "grey60",
      hjust = 0.5, vjust = 0,
      margin = margin(t = 5, b = 10)
    ),
    legend.text = element_text(
      size = 10,
      color = "grey20"
    ),
    legend.title = element_text(
      size = 11,
      color = "grey20"
    ),
    legend.position = "bottom"
  )
```

## A note on caching

Some data sets (as Local Administrative Units - LAU, or high-resolution files)
may have a size larger than 50MB. You can use `giscoR` to create your own local
repository at a given local directory passing the following option:

```{r, eval=FALSE}
options(gisco_cache_dir = "./path/to/location")
```

When this option is set, `giscoR` would look for the cached file and it will
load it, speeding up the process.

You can also download manually the files (`.geojson` format) and store them on
your local directory.

## Recommended packages

### API data packages

-   `eurostat` package (<https://ropengov.github.io/eurostat/>). This is an API
    package that provides access to open data from Eurostat.

### Plotting `sf` objects

Some packages recommended for visualization are:

-   [`tmap`](https://mtennekes.github.io/tmap/)
-   [`ggplot2`](https://github.com/tidyverse/ggplot2) +
    [`ggspatial`](https://github.com/paleolimbot/ggspatial)
-   [`mapsf`](https://riatelab.github.io/mapsf/)
-   [`leaflet`](https://rstudio.github.io/leaflet/)

## Contribute

Check the GitHub page for [source code](https://github.com/dieghernan/giscoR/).

Contributions are very welcome:

-   [Use issue tracker](https://github.com/dieghernan/giscoR/issues) for
    feedback and bug reports.
-   [Send pull requests](https://github.com/dieghernan/giscoR/)
-   [Star us on the GitHub page](https://github.com/dieghernan/giscoR)

## Copyright notice

*From GISCO \> Geodata \> Reference data \> Administrative Units / Statistical
Units*

When data downloaded from this page is used in any printed or electronic
publication, in addition to any other provisions applicable to the whole
Eurostat website, data source will have to be acknowledged in the legend of the
map and in the introductory page of the publication with the following copyright
notice:

EN: © EuroGeographics for the administrative boundaries

FR: © EuroGeographics pour les limites administratives

DE: © EuroGeographics bezüglich der Verwaltungsgrenzen

For publications in languages other than English, French or German, the
translation of the copyright notice in the language of the publication shall be
used.

If you intend to use the data commercially, please contact EuroGeographics for
information regarding their licence agreements.

## Disclaimer

This package is in no way officially related to or endorsed by Eurostat.
