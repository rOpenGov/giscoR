---
title: "Get started with giscoR"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Get started with giscoR}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  warning = FALSE,
  message = FALSE,
  out.width = "100%"
)
```

# Introduction

*Full site with more examples and vignettes on
<https://dieghernan.github.io/giscoR/>*

[**`giscoR`**](https://dieghernan.github.io/giscoR/) is a package designed to
provide a clean interaction with the [GISCO
API](https://gisco-services.ec.europa.eu/distribution/v2/).

Within Eurostat, GISCO is responsible for meeting the European Commission's
geographical information needs at 3 levels: the European Union, its member
countries, and its regions. GISCO also provides a variety of shapefiles on
different formats, focusing specially in the European Union area, but providing
also some worldwide shapefiles, as country polygons, labels or borders and
coastal lines.

GISCO provides data on different resolutions suitable for representing small
areas (01M, 03M) as well as lightweight datasets specially useful for
representing wider areas (10M, 20M, 60M). Shapefiles are provided on 3 different
projections: EPSG 4326, 3035 or 3857.

`giscoR` returns `sf` objects, so the `sf` package is necessary.

# Caching

`giscoR` provides a dataset caching capability, that could be set as:

```{r, eval = FALSE}
options(gisco_cache_dir = "~/path/to/dir")
```

When this option is set, `giscoR` just load first the requested shapefile from
the local directory, speeding up the loading process. If the file is not
available locally, it would be downloaded to that directory so the next time you
need the corresponding data it would be loaded from the local directory.

If you experience any problems on downloading, you can also manually download
the file from the [GISCO API
website](https://gisco-services.ec.europa.eu/distribution/v2/) and store it on
your local directory.

# Installation

Install `giscoR` from [**CRAN**](https://CRAN.R-project.org/package=giscoR):

```{r, eval=FALSE}
install.packages("giscoR")
```

Development version ([GitHub](https://github.com/dieghernan/giscoR/)):

```{r, eval=FALSE}
library(remotes)
install_github("dieghernan/giscoR")
```

Alternatively, you can install `giscoR` using the
[r-universe](https://dieghernan.r-universe.dev/ui#builds):

```{r, eval=FALSE}
# Enable this universe
options(repos = c(
  dieghernan = "https://dieghernan.r-universe.dev",
  CRAN = "https://cloud.r-project.org"
))


install.packages("giscoR")
```

# Downloading data

Please be aware that [downloading provisions
apply](https://ec.europa.eu/eurostat/web/gisco/geodata) when using GISCO data.
There is a function, `gisco_attributions` that would guide you on this topic. It
also provides attributions on several languages.

```{r, message=TRUE}
library(giscoR)
gisco_attributions(copyright = TRUE)
```

# Basic example

Some examples on data downloads

```{r country}

library(sf)
library(ggplot2) # Use ggplot for plotting


Asia <- gisco_get_countries(region = "Asia")


ggplot(Asia) +
  geom_sf(fill = "cornsilk", color = "#887e6a") +
  theme(
    panel.background = element_rect(fill = "#fffff3"),
    panel.border = element_rect(
      colour = "#887e6a",
      fill = NA,
      size = 1.5
    ),
    axis.text = element_text(
      family = "serif",
      colour = "#887e6a",
      face = "bold"
    )
  )
```

You can select specific countries by name (in any language), ISO 3 codes or
Eurostat codes. The only restriction is that you can't mix country names, ISO3
and Eurostat codes on one single call.

It is possible also to combine different shapefiles, just set `resolution` and
`epsg` (and optionally `year`) to the same value:

```{r africa}

africa_north <-
  gisco_get_countries(
    country = c("Morocco", "Argelia", "Libia", "Tunisia", "Egypt"),
    resolution = "20",
    epsg = "4326",
    year = "2016"
  )

# Coastal lines

coast <- gisco_get_coastallines(
  resolution = "20",
  epsg = "4326",
  year = "2016"
)

# Plot

ggplot(coast) +
  geom_sf(color = "grey80") +
  geom_sf(data = africa_north, fill = "grey30", color = "white") +
  coord_sf(
    xlim = c(-13, 37),
    ylim = c(18.5, 40)
  ) +
  theme(
    axis.ticks = element_blank(),
    axis.text = element_blank()
  ) +
  facet_wrap(vars(NAME_ENGL), ncol = 2)
```

# Plotting `giscoR`

This is an example on how `giscoR` can play nicely with some Eurostat data. For
plotting purposes we would use the `ggplot2` package however any package that
handles `sf` objects (e.g. `tmap`, `mapsf`, `leaflet`, etc. could be used).

Also `colorspace` and `rcartocolor` packages are recommended, as they provide
great color palettes.

```{r giscoR, fig.asp=1}

nuts2 <- gisco_get_nuts(
  year = "2016",
  epsg = "4326",
  resolution = "20",
  nuts_level = "2"
)

# Borders
borders <- gisco_get_countries(
  epsg = "4326",
  year = "2016",
  resolution = "20",
  region = c("Europe")
)

# Eurostat data - Purchase parity power
pps <- giscoR::tgs00026
pps <- pps[pps$time == 2016, ]

# Breaks
br <- c(0, 14, 16, 18, 20, 22, 24, 26, 1000) * 1000

nuts2.sf <- merge(nuts2,
  pps,
  by.x = "NUTS_ID",
  by.y = "geo",
  all.x = TRUE
)

# Cut
nuts2.sf$values_groups <- cut(nuts2.sf$values, breaks = br)

# Labels
labels <- paste0(br / 1000, "k")[-1]
labels[1] <- "<14K"
labels[8] <- ">26k"



# Plot
pal <- hcl.colors(9, "Lajolla")

ggplot(nuts2.sf) +
  geom_sf(aes(fill = values_groups), color = NA, alpha = 0.9) +
  geom_sf(data = borders, fill = NA, size = 0.5) +
  coord_sf(
    xlim = c(-1, 17),
    ylim = c(46, 57)
  ) +
  labs(
    title = "Disposable Incoming Households",
    subtitle = "NUTS-2 level - 2016",
    caption = paste0(
      "Source: Eurostat\n ", gisco_attributions()
    )
  ) +
  scale_fill_manual(
    name = "euros",
    values = pal,
    drop = FALSE,
    labels = labels,
    guide = guide_legend(
      direction = "horizontal",
      keyheight = 0.5,
      keywidth = 1.5,
      title.position = "top",
      title.hjust = 0.5,
      label.hjust = .5,
      nrow = 1,
      byrow = TRUE,
      reverse = FALSE,
      label.position = "bottom"
    )
  ) +
  theme_void() +
  # Theme
  theme(
    plot.title = element_text(
      size = 16, color = pal[length(pal) - 1],
      hjust = 0.5
    ),
    plot.subtitle = element_text(
      size = 12,
      color = pal[length(pal) - 1],
      hjust = 0.5, face = "bold"
    ),
    plot.caption = element_text(
      size = 8, color = "grey20",
      hjust = 0.5,
      margin = margin(t = 5, b = 5)
    ),
    legend.text = element_text(
      size = 10,
      color = "grey20"
    ),
    legend.title = element_text(
      size = 11,
      color = "grey20"
    ),
    legend.position = "bottom"
  )
```


