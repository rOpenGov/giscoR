---
title: "Get started with giscoR"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Get started with giscoR}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  warning = FALSE,
  message = FALSE,
  fig.width = 6,
  fig.height = 4,
  out.width = "100%",
  out.height = "60%"
)
```


# Introduction

*Full site with more examples and vignettes on
<https://dieghernan.github.io/giscoR/>*

[**`giscoR`**](https://dieghernan.github.io/giscoR/) is a package designed to 
provide a clean interaction with the 
[GISCO API](https://gisco-services.ec.europa.eu/distribution/v2/). 

Within Eurostat, GISCO is responsible for meeting the European Commission's 
geographical information needs at 3 levels: the European Union, its member 
countries, and its regions. GISCO also provides a variety of shapefiles on 
different formats, focusing specially in the European Union area, but providing 
also some worldwide shapefiles, as country polygons, labels or borders and 
coastal lines.

GISCO provides data on different resolutions suitable for representing small 
areas (01M, 03M) as well as lightweight datasets specially useful for 
representing wider areas (10M, 20M, 60M). Shapefiles are provided on 3 
different projections: EPSG 4326, 3035 or 3857. 

`giscoR` returns `sf` objects, so the `sf` package is necessary.

# Caching

`giscoR` provides a dataset caching capability, that could be set as:

```r
options(gisco_cache_dir = "~/path/to/dir")
```

When this option is set, `giscoR` just load first the requested shapefile from 
the local directory, speeding up the loading process. If the file is not 
available locally, it would be downloaded to that directory so the next time 
you need the corresponding data it would be loaded from the local directory. 

If you experience any problems on downloading, you can also manually download 
the file from the 
[GISCO API website](https://gisco-services.ec.europa.eu/distribution/v2/) and 
store it on your local directory.


# Installation

Install `giscoR` from [**CRAN**](https://CRAN.R-project.org/package=giscoR):

``` r
install.packages("giscoR")
```

Development version ([Github](https://github.com/dieghernan/giscoR/)):

```r
library(remotes)
install_github("dieghernan/giscoR")
```

# Downloading data

Please be aware that 
[downloading provisions apply](https://ec.europa.eu/eurostat/web/gisco/geodata) 
when using GISCO data. There is a function, `gisco_attributions` that would 
guide you on this topic. It also provides attributions on several languages.

```{r attributions}
library(giscoR)
gisco_attributions(copyright = TRUE)
```

# Basic example

Some examples on data downloads

```{r country_reg}

library(sf)
library(tmap) # Use tmap for plotting


countries <- gisco_get_countries(region = "Asia")

tmap_style("classic")

tm_shape(countries) +
  tm_graticules(lines = FALSE) +
  tm_polygons() +
  tm_credits(gisco_attributions(copyright = "FALSE")) +
  tm_layout(
    main.title = "Countries of Asia",
    attr.outside = TRUE
  )

tmap_options_reset()
```


You can select specific countries by name (in any language), ISO 3 codes or Eurostat codes. The only restriction is that you can't mix country names, ISO3 and Eurostat codes on one single call.

It is possible also to combine different shapefiles, just set `resolution` and `epsg` (and optionally `year`) to the same value:


```{r africa_north}

africa_north <-
  gisco_get_countries(
    country = c("Morocco", "Argelia", "Libia", "Tunisia", "Egypt"),
    resolution = "20",
    epsg = "4326",
    year = "2016"
  )

# Coastal lines

coast <- gisco_get_coastallines(
  resolution = "20",
  epsg = "4326",
  year = "2016"
)

# Plot

# Coastline
tm_shape(coast, bbox = c(-13, 18.5, 37, 40)) +
  tm_fill(col = "grey80") +
  # Shape of Africa
  tm_shape(africa_north) +
  tm_polygons(col = "grey30", border.col = "white") +
  # Facets
  tm_facets(by = "NAME_ENGL") +
  tm_credits(gisco_attributions(copyright = "FALSE"),
    position = c("right", "bottom")
  ) +
  tm_layout(attr.outside = TRUE)
```

# Plotting `giscoR`

This is an example on how `giscoR` can play nicely with some Eurostat data. For 
plotting purposes we would use the 
[`tmap` package](https://mtennekes.github.io/tmap/), however any package that 
handles `sf` objects (e.g. `ggplot2`, `mapsf`, `leaflet`, etc. could be used). 

Also `colorspace` and `rcartocolor` packages are recommended, as they provide 
great color palettes.

```{r giscoR_eurostat}


nuts2 <- gisco_get_nuts(
  year = "2016",
  epsg = "4326",
  resolution = "20",
  nuts_level = "2"
)

# Borders
borders <- gisco_get_countries(
  epsg = "4326",
  year = "2016",
  resolution = "20",
  region = c("Europe")
)

# Eurostat data - Purchase parity power
pps <- giscoR::tgs00026
pps <- pps[pps$time == 2016, ]

nuts2.sf <- merge(nuts2,
  pps,
  by.x = "NUTS_ID",
  by.y = "geo",
  all.x = TRUE
)
# Plot

tm_shape(nuts2.sf, bbox = c(-1, 47, 10, 54)) +
  tm_polygons(
    "values",
    pal = "-inferno",
    alpha = 0.6,
    style = "headtails",
    style.args = list(thr = 1),
    showNA = FALSE,
    border.alpha = 0.5,
    border.col = "grey50",
    title = "Euro (EUR)"
  ) +
  # Add borders
  tm_shape(borders) +
  tm_borders(col = "black") +
  # Credits and format
  tm_credits(gisco_attributions(),
    position = c("right", "bottom")
  ) +
  tm_layout(
    main.title = "Disposable Incoming Households 2016 (BENELUX Focus)",
    main.title.size = 0.8,
    main.title.fontface = "bold",
    legend.outside = TRUE,
    attr.outside = TRUE
  )
```

## Session Info

<details>
  <summary><strong>Details</strong></summary>
  
```{r session_info, echo=FALSE}
sessionInfo()
```
</details>
